# docker/postgres/postgresql.dev.conf
# Configuration PostgreSQL DÉVELOPPEMENT

# ===================
# CONNEXIONS
# ===================
listen_addresses = '*'
max_connections = 20
shared_preload_libraries = 'pg_stat_statements'

# ===================
# MÉMOIRE (4GB RAM)
# ===================
shared_buffers = 512MB
effective_cache_size = 2GB
work_mem = 8MB
maintenance_work_mem = 128MB
temp_buffers = 16MB

# ===================
# OPTIMISATIONS TYPEORM
# ===================
random_page_cost = 1.1
seq_page_cost = 1.0
default_statistics_target = 50
constraint_exclusion = partition

# ===================
# WAL (dev optimisé)
# ===================
wal_buffers = 16MB
checkpoint_completion_target = 0.9
wal_writer_delay = 200ms
checkpoint_timeout = 15min

# ===================
# LOGGING DÉVELOPPEMENT
# ===================
log_destination = 'stderr'
logging_collector = off
log_statement = all
log_min_messages = info
log_min_error_statement = error
log_min_duration_statement = 100
log_line_prefix = '%t [%p]: [%l-1] user=%u,db=%d,app=%a '
log_checkpoints = on
log_connections = on
log_disconnections = on
log_lock_waits = on
log_temp_files = 0

# ===================
# DÉVELOPPEMENT RAPIDE
# ===================
fsync = off                    # DANGER: dev uniquement !
synchronous_commit = off       # DANGER: dev uniquement !
full_page_writes = off         # DANGER: dev uniquement !

# ===================
# SÉCURITÉ DEV
# ===================
ssl = off
password_encryption = scram-sha-256

# ===================
# MONITORING
# ===================
track_activities = on
track_counts = on
track_io_timing = on
track_functions = all